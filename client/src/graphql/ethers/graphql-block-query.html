<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <script type="text/javascript">

    async function getBlockByNumber() {
      const blockNumber = parseInt(document.getElementById('blockNumber').value);

      if (!blockNumber || blockNumber < 0) {
        alert('Please enter a valid block number');
        return;
      }

      const query = `
        query GetBlockByNumber($blockNumber: Float!) {
          getBlockByNumber(blockNumber: $blockNumber) {
            blockNumber
            creationDate
            hash
            nonce
            transactionCount
          }
        }
      `;

      try {
        const res = await fetch('http://127.0.0.1:3000/graphql', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            query: query,
            variables: { blockNumber: blockNumber }
          })
        });

        const json = await res.json();
        console.log(res);
        console.log(json);

        if (json.errors) {
          const errorMessage = document.createElement('div');
          errorMessage.style.color = 'red';
          errorMessage.appendChild(document.createTextNode('Error: ' + JSON.stringify(json.errors)));
          errorMessage.appendChild(document.createElement('hr'));
          document.querySelector('#messages').appendChild(errorMessage);
          return;
        }

        const block = json.data.getBlockByNumber;
        const message = document.createElement('div');
        message.appendChild(document.createTextNode(JSON.stringify(block, null, 2)));
        message.appendChild(document.createElement('br'));
        message.appendChild(document.createElement('br'));

        const link = document.createElement('a');
        link.href = `https://etherscan.io/block/${block.blockNumber}`;
        link.text = `View Block ${block.blockNumber} on Etherscan`;
        link.target = '_blank';
        link.title = 'Open Block in Etherscan';
        message.appendChild(link);
        message.appendChild(document.createElement('hr'));

        document.querySelector('#messages').appendChild(message);
      } catch (error) {
        const errorMessage = document.createElement('div');
        errorMessage.style.color = 'red';
        errorMessage.appendChild(document.createTextNode('Error: ' + error.message));
        errorMessage.appendChild(document.createElement('hr'));
        document.querySelector('#messages').appendChild(errorMessage);
      }
    }

  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@picocss/pico@2.1.1/css/pico.min.css">
  <title>Ethers.js SDK with GraphQL: Block Query</title>
</head>
<body class="pico-background-pumpkin-30">
<hgroup>
  <header class="container-fluid pico-background-pumpkin-50">
    <nav>
      <ul>
        <li><img src="../../../img/eth-diamond.svg" alt="Solana Logo" width="40" /></li>
        <li>Ethereum</li>
      </ul>
      <ul>
        <li><a href="http://127.0.0.1:3000/graphql" target="_blank">Source:
          http://127.0.0.1:3000/graphql</a></li>
      </ul>
    </nav>
    <hr />
  </header>
</hgroup>
<main class="container">
  <h4>Ethers.js SDK with GraphQL Thin Client: Block Query</h4>
  <p>Nest.js GraphQL API with RxJS Observables with Vanilla.js Client</p>

  <div class="grid">
    <div>
      <article>
        <strong>GraphQL Query - Get Block by Number</strong>
        <p>
          <label for="blockNumber">Block Number:</label>
          <input type="number" id="blockNumber" name="blockNumber" placeholder="Enter block number (e.g., 21500000)" value="21500000" min="0">
        </p>
        <article id="messages"></article>
      </article>
      <button onclick="getBlockByNumber()"
              title="Query block by number">
        Query Block
      </button>
    </div>
    <div></div>
  </div>
</main>
<footer class="container-fluid">
  <hr />
  <article>GraphQL Thin Client Demo</article>
</footer>
</body>
</html>
